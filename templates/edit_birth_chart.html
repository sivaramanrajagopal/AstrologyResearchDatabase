{% extends "base.html" %}

{% block title %}Edit Birth Chart - {{ chart.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-edit"></i> Edit Birth Chart: {{ chart.name }}</h1>
            <a href="{{ url_for('view_chart_details', chart_id=chart.id) }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Chart
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user-edit"></i> Edit Birth Chart Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" id="editBirthChartForm">
                    <!-- Personal Information -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-user"></i> Personal Information</h6>
                        </div>
                        <div class="col-md-6">
                            <label for="name" class="form-label">Full Name *</label>
                            <input type="text" class="form-control" id="name" name="name" value="{{ chart.name }}" required>
                            <div class="form-text">Enter the person's full name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="gender" class="form-label">Gender *</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male" {% if chart.gender == 'Male' %}selected{% endif %}>Male</option>
                                <option value="Female" {% if chart.gender == 'Female' %}selected{% endif %}>Female</option>
                                <option value="Other" {% if chart.gender == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                    </div>

                    <!-- Birth Details -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-calendar"></i> Birth Details</h6>
                        </div>
                        <div class="col-md-6">
                            <label for="date_of_birth" class="form-label">Date of Birth *</label>
                            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" 
                                   value="{{ chart.date_of_birth.strftime('%Y-%m-%d') }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="time_of_birth" class="form-label">Time of Birth *</label>
                            <input type="time" class="form-control" id="time_of_birth" name="time_of_birth" 
                                   value="{{ chart.time_of_birth.strftime('%H:%M') }}" required>
                            <div class="form-text">Use 24-hour format (e.g., 14:30 for 2:30 PM)</div>
                        </div>
                    </div>

                    <!-- Birth Location -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-map-marker-alt"></i> Birth Location</h6>
                        </div>
                        <div class="col-md-6">
                            <label for="city" class="form-label">City *</label>
                            <input type="text" class="form-control" id="city" name="city" value="{{ chart.city }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="country" class="form-label">Country *</label>
                            <input type="text" class="form-control" id="country" name="country" value="{{ chart.country }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="latitude" class="form-label">Latitude</label>
                            <input type="number" step="0.000001" class="form-control" id="latitude" name="latitude" 
                                   value="{{ chart.latitude or '' }}" placeholder="e.g., 40.7128">
                            <div class="form-text">Optional: For accurate planetary calculations</div>
                        </div>
                        <div class="col-md-6">
                            <label for="longitude" class="form-label">Longitude</label>
                            <input type="number" step="0.000001" class="form-control" id="longitude" name="longitude" 
                                   value="{{ chart.longitude or '' }}" placeholder="e.g., -74.0060">
                            <div class="form-text">Optional: For accurate planetary calculations</div>
                        </div>
                    </div>

                    <!-- Research Information -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-microscope"></i> Research Information</h6>
                        </div>
                        <div class="col-md-6">
                            <label for="research_category" class="form-label">Research Category *</label>
                            <select class="form-select" id="research_category" name="research_category" required>
                                <option value="">Select Research Category</option>
                                {% for category in categories %}
                                <option value="{{ category }}" {% if chart.research_category == category %}selected{% endif %}>{{ category }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="researcher_id" class="form-label">Researcher ID *</label>
                            <input type="text" class="form-control" id="researcher_id" name="researcher_id" 
                                   value="{{ chart.researcher_id }}" required>
                            <div class="form-text">Your unique identifier for this research</div>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-sticky-note"></i> Additional Notes</h6>
                        </div>
                        <div class="col-12">
                            <label for="additional_notes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="additional_notes" name="additional_notes" rows="4" 
                                      placeholder="Any additional information about this birth chart...">{{ chart.additional_notes or '' }}</textarea>
                            <div class="form-text">Optional: Add any relevant notes for research purposes</div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Update Birth Chart
                                </button>
                                <a href="{{ url_for('view_chart_details', chart_id=chart.id) }}" class="btn btn-outline-secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Warning Modal for Planetary Recalculation -->
<div class="modal fade" id="planetaryWarningModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">⚠️ Planetary Positions Will Be Recalculated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Changing birth details will recalculate all planetary positions. This ensures accuracy but may take a moment.</p>
                <p><strong>Note:</strong> Make sure the birth time and location are accurate for precise calculations.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">Continue</button>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('editBirthChartForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Show warning modal
    var modal = new bootstrap.Modal(document.getElementById('planetaryWarningModal'));
    modal.show();
});

function submitForm() {
    document.getElementById('editBirthChartForm').submit();
}
</script>
{% endblock %} 