<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Birth Chart Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .chart-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        .planet-table {
            background-color: white;
            border-radius: 5px;
        }
        .house-table {
            background-color: white;
            border-radius: 5px;
        }
        .yoga-card {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        .shadbala-card {
            background-color: #f3e5f5;
            border-left: 4px solid #9c27b0;
        }
        .aspect-card {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .status-strong { color: #4caf50; font-weight: bold; }
        .status-moderate { color: #ff9800; font-weight: bold; }
        .status-weak { color: #f44336; font-weight: bold; }
        .retrograde { color: #f44336; font-weight: bold; }
        .direct { color: #4caf50; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">üîÆ Enhanced Birth Chart Analysis</h1>
                
                <!-- Basic Information -->
                <div class="chart-section">
                    <h3>üìã Basic Information</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Name:</strong> {{ chart.name }}</p>
                            <p><strong>Gender:</strong> {{ chart.gender }}</p>
                            <p><strong>Date of Birth:</strong> {{ chart.date_of_birth }}</p>
                            <p><strong>Time of Birth:</strong> {{ chart.time_of_birth }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Place of Birth:</strong> {{ chart.place_of_birth }}</p>
                            <p><strong>Coordinates:</strong> {{ chart.latitude }}, {{ chart.longitude }}</p>
                            <p><strong>Timezone:</strong> {{ chart.timezone_name }}</p>
                            <p><strong>Created:</strong> {{ chart.created_at }}</p>
                        </div>
                    </div>
                </div>

                <!-- Planetary Positions -->
                <div class="chart-section">
                    <h3>ü™ê Planetary Positions</h3>
                    <div class="table-responsive">
                        <table class="table table-striped planet-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>Planet</th>
                                    <th>Longitude</th>
                                    <th>Rasi</th>
                                    <th>Rasi Lord</th>
                                    <th>Nakshatra</th>
                                    <th>Nakshatra Lord</th>
                                    <th>Pada</th>
                                    <th>Degrees in Rasi</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for planet in ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn', 'Rahu', 'Ketu', 'Ascendant'] %}
                                    {% set planet_lower = planet.lower() %}
                                    {% if chart[planet_lower + '_longitude'] is not none %}
                                    <tr>
                                        <td><strong>{{ planet }}</strong></td>
                                        <td>{{ "%.2f"|format(chart[planet_lower + '_longitude']) }}¬∞</td>
                                        <td>{{ chart[planet_lower + '_rasi'] }}</td>
                                        <td>{{ chart[planet_lower + '_rasi_lord'] }}</td>
                                        <td>{{ chart[planet_lower + '_nakshatra'] }}</td>
                                        <td>{{ chart[planet_lower + '_nakshatra_lord'] }}</td>
                                        <td>{{ chart[planet_lower + '_pada'] }}</td>
                                        <td>{{ "%.2f"|format(chart[planet_lower + '_degrees_in_rasi']) }}¬∞</td>
                                        <td>
                                            {% if chart[planet_lower + '_retrograde'] %}
                                                <span class="retrograde">Retrograde</span>
                                            {% else %}
                                                <span class="direct">Direct</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- House Positions -->
                <div class="chart-section">
                    <h3>üè† House Positions</h3>
                    <div class="table-responsive">
                        <table class="table table-striped house-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>House</th>
                                    <th>Longitude</th>
                                    <th>Rasi</th>
                                    <th>Degrees in Rasi</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in range(1, 13) %}
                                    {% if chart['house_' + i|string + '_longitude'] is not none %}
                                    <tr>
                                        <td><strong>{{ i }}th House</strong></td>
                                        <td>{{ "%.2f"|format(chart['house_' + i|string + '_longitude']) }}¬∞</td>
                                        <td>{{ chart['house_' + i|string + '_rasi'] }}</td>
                                        <td>{{ "%.2f"|format(chart['house_' + i|string + '_degrees']) }}¬∞</td>
                                    </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Yogas -->
                {% if chart.yogas %}
                <div class="chart-section">
                    <h3>üßò Yogas (Planetary Combinations)</h3>
                    <div class="row">
                        {% for yoga in chart.yogas %}
                        <div class="col-md-6 mb-3">
                            <div class="card yoga-card">
                                <div class="card-body">
                                    <h5 class="card-title">{{ yoga.name }}</h5>
                                    <p class="card-text"><strong>Type:</strong> {{ yoga.type }}</p>
                                    <p class="card-text"><strong>Planets:</strong> {{ yoga.planets|join(', ') }}</p>
                                    <p class="card-text">{{ yoga.description }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Shadbala -->
                {% if chart.shadbala %}
                <div class="chart-section">
                    <h3>‚öñÔ∏è Shadbala (Six-fold Strength)</h3>
                    <div class="row">
                        {% for planet, data in chart.shadbala.items() %}
                        <div class="col-md-4 mb-3">
                            <div class="card shadbala-card">
                                <div class="card-body">
                                    <h6 class="card-title">{{ planet }}</h6>
                                    <p class="card-text">
                                        <strong>Total Strength:</strong> {{ data.total_strength }}<br>
                                        <strong>Status:</strong> 
                                        <span class="status-{{ data.status.lower() }}">{{ data.status }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Aspects -->
                {% if chart.aspects %}
                <div class="chart-section">
                    <h3>üîó Planetary Aspects</h3>
                    <div class="row">
                        {% for aspect in chart.aspects %}
                        <div class="col-md-6 mb-3">
                            <div class="card aspect-card">
                                <div class="card-body">
                                    <h6 class="card-title">{{ aspect.type }}</h6>
                                    <p class="card-text">
                                        <strong>Planets:</strong> {{ aspect.planets|join(' ‚Üî ') }}<br>
                                        <strong>Distance:</strong> {{ aspect.distance }}¬∞<br>
                                        <strong>Description:</strong> {{ aspect.description }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Research Categories -->
                {% if chart.primary_category or chart.sub_category or chart.specific_condition %}
                <div class="chart-section">
                    <h3>üìä Research Categories</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <p><strong>Primary Category:</strong> {{ chart.primary_category or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Sub Category:</strong> {{ chart.sub_category or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Specific Condition:</strong> {{ chart.specific_condition or 'Not specified' }}</p>
                        </div>
                    </div>
                    {% if chart.description %}
                    <div class="row">
                        <div class="col-12">
                            <p><strong>Description:</strong> {{ chart.description }}</p>
                        </div>
                    </div>
                    {% endif %}
                    <div class="row">
                        <div class="col-md-3">
                            <p><strong>Outcome:</strong> {{ chart.outcome or 'Unknown' }}</p>
                        </div>
                        <div class="col-md-3">
                            <p><strong>Severity:</strong> {{ chart.severity or 'Unknown' }}</p>
                        </div>
                        <div class="col-md-3">
                            <p><strong>Timing:</strong> {{ chart.timing or 'Unknown' }}</p>
                        </div>
                        <div class="col-md-3">
                            <p><strong>Researcher ID:</strong> {{ chart.researcher_id or 'Not specified' }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Travel Information -->
                {% if chart.travel_country or chart.travel_city %}
                <div class="chart-section">
                    <h3>‚úàÔ∏è Travel Information</h3>
                    <div class="row">
                        <div class="col-md-3">
                            <p><strong>Country:</strong> {{ chart.travel_country or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-3">
                            <p><strong>City:</strong> {{ chart.travel_city or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-3">
                            <p><strong>Purpose:</strong> {{ chart.travel_purpose or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-3">
                            <p><strong>Outcome:</strong> {{ chart.travel_outcome or 'Not specified' }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Action Buttons -->
                <div class="text-center mt-4">
                    <a href="{{ url_for('view_charts') }}" class="btn btn-secondary">‚Üê Back to Charts</a>
                    <a href="{{ url_for('add_birth_chart') }}" class="btn btn-primary">‚ûï Add New Chart</a>
                    <a href="{{ url_for('edit_birth_chart', chart_id=chart.id) }}" class="btn btn-warning">‚úèÔ∏è Edit Chart</a>
                    <form method="POST" action="{{ url_for('delete_birth_chart', chart_id=chart.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this chart?')">üóëÔ∏è Delete Chart</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 